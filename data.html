

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data &mdash; OpenNMT-tf 1.20.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.20.1',
              LANGUAGE:'en',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tokenization" href="tokenization.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OpenNMT-tf
          

          
            
            <img src="_static/logo-alpha.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.20
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-format">Data format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#text">Text</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vocabulary">Vocabulary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#via-training-files">via training files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#via-sentencepiece-vocabulary">via SentencePiece vocabulary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vectors">Vectors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#via-python">via Python</a></li>
<li class="toctree-l4"><a class="reference internal" href="#via-the-ark-text-format">via the ARK text format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#alignments">Alignments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-location">Data location</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pretrained-embeddings">Pretrained embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parallel-inputs">Parallel inputs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tokenization.html">Tokenization</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="inference.html">Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="serving.html">Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_reference.html">Reference: Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="package/opennmt.html">Reference: opennmt package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenNMT-tf</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data">
<h1>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="data-format">
<h2>Data format<a class="headerlink" href="#data-format" title="Permalink to this headline">¶</a></h2>
<p>The format of the data files is defined by the <code class="docutils literal notranslate"><span class="pre">opennmt.inputters.Inputter</span></code> used by your model.</p>
<div class="section" id="text">
<h3>Text<a class="headerlink" href="#text" title="Permalink to this headline">¶</a></h3>
<p>All <code class="docutils literal notranslate"><span class="pre">opennmt.inputters.TextInputter</span></code>s expect a text file as input where:</p>
<ul class="simple">
<li>sentences are separated by a <strong>newline</strong></li>
<li>tokens are separated by a <strong>space</strong> (unless a custom tokenizer is set, see <a class="reference external" href="tokenization.html">Tokenization</a>)</li>
</ul>
<p>For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ head -5 data/toy-ende/src-train.txt
It is not acceptable that , with the help of the national bureaucracies , Parliament &amp;apos;s legislative prerogative should be made null and void by means of implementing provisions whose content , purpose and extent are not laid down in advance .
Federal Master Trainer and Senior Instructor of the Italian Federation of Aerobic Fitness , Group Fitness , Postural Gym , Stretching and Pilates; from 2004 , he has been collaborating with Antiche Terme as personal Trainer and Instructor of Stretching , Pilates and Postural Gym .
&amp;quot; Two soldiers came up to me and told me that if I refuse to sleep with them , they will kill me . They beat me and ripped my clothes .
Yes , we also say that the European budget is not about the duplication of national budgets , but about delivering common goals beyond the capacity of nation states where European funds can realise economies of scale or create synergies .
The name of this site , and program name Title purchased will not be displayed .
</pre></div>
</div>
</div>
<div class="section" id="vocabulary">
<h3>Vocabulary<a class="headerlink" href="#vocabulary" title="Permalink to this headline">¶</a></h3>
<p>For text inputs, vocabulary files should be provided in the data configuration (see for example in the <em>Quickstart</em> section). OpenNMT-tf uses a simple text format with <strong>one token per line</strong>, which should begin with these special tokens:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;blank&gt;
&lt;s&gt;
&lt;/s&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">onmt-build-vocab</span></code> script can be used to generate this file:</p>
<div class="section" id="via-training-files">
<h4>via training files<a class="headerlink" href="#via-training-files" title="Permalink to this headline">¶</a></h4>
<p>The script can be run directly on training files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>onmt-build-vocab --save_vocab vocab.txt train.txt
</pre></div>
</div>
<ul class="simple">
<li>To control the vocabulary size, see the available options <code class="docutils literal notranslate"><span class="pre">onmt-build-vocab</span> <span class="pre">-h</span></code></li>
<li>By default, <code class="docutils literal notranslate"><span class="pre">train.txt</span></code> is expected to be <strong>tokenized</strong> (see the <em>Tokenization</em> section to execute the script on non tokenized files)</li>
</ul>
</div>
<div class="section" id="via-sentencepiece-vocabulary">
<h4>via SentencePiece vocabulary<a class="headerlink" href="#via-sentencepiece-vocabulary" title="Permalink to this headline">¶</a></h4>
<p>If you trained a <a class="reference external" href="https://github.com/google/sentencepiece">SentencePiece</a> model to tokenize your data, a vocabulary file <code class="docutils literal notranslate"><span class="pre">*.vocab</span></code> was generated in the process. This file can be converted to the OpenNMT-tf vocabulary format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>onmt-build-vocab --save_vocab vocab.txt --from_vocab sp.vocab --from_format sentencepiece
</pre></div>
</div>
</div>
</div>
<div class="section" id="vectors">
<h3>Vectors<a class="headerlink" href="#vectors" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">opennmt.inputters.SequenceRecordInputter</span></code> expects a file with serialized <em>TFRecords</em>. We propose 2 ways to create this file, choose the one that is the easiest for you:</p>
<div class="section" id="via-python">
<h4>via Python<a class="headerlink" href="#via-python" title="Permalink to this headline">¶</a></h4>
<p>It is very simple to generate a compatible <em>TFRecords</em> file directly from Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">opennmt</span> <span class="kn">as</span> <span class="nn">onmt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">TFRecordWriter</span><span class="p">(</span><span class="s2">&quot;data.records&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
  <span class="n">onmt</span><span class="o">.</span><span class="n">inputters</span><span class="o">.</span><span class="n">write_sequence_record</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">writer</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This example saves a dataset of 3 random vectors of shape <code class="docutils literal notranslate"><span class="pre">[time,</span> <span class="pre">dim]</span></code> into the file “data.records”. It should be easy to adapt for any dataset of 2D vectors.</p>
</div>
<div class="section" id="via-the-ark-text-format">
<h4>via the ARK text format<a class="headerlink" href="#via-the-ark-text-format" title="Permalink to this headline">¶</a></h4>
<p>The script <code class="docutils literal notranslate"><span class="pre">onmt-ark-to-records</span></code> proposes an alternative way to generate this dataset. It converts the ARK text format:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>KEY [
FEAT1.1 FEAT1.2 FEAT1.3 ... FEAT1.n
...
FEATm.1 FEATm.2 FEATm.3 ... FEATm.n ]
</pre></div>
</div>
<p>which describes an example of <code class="docutils literal notranslate"><span class="pre">m</span></code> vectors of depth <code class="docutils literal notranslate"><span class="pre">n</span></code> and identified by <code class="docutils literal notranslate"><span class="pre">KEY</span></code>.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">onmt-ark-to-records</span> <span class="pre">-h</span></code> for the script usage. It also accepts an optional indexed text file (i.e. with lines prefixed with <code class="docutils literal notranslate"><span class="pre">KEY</span></code>s) to generate aligned source vectors and target texts.</p>
</div>
</div>
<div class="section" id="alignments">
<h3>Alignments<a class="headerlink" href="#alignments" title="Permalink to this headline">¶</a></h3>
<p>Guided alignment requires a training alignment file that uses the “Pharaoh” format, e.g.:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0-0 1-1 2-4 3-2 4-3 5-5 6-6
0-0 1-1 2-2 2-3 3-4 4-5
0-0 1-2 2-1 3-3 4-4 5-5
</pre></div>
</div>
<p>where a pair <code class="docutils literal notranslate"><span class="pre">i-j</span></code> indicates that the <code class="docutils literal notranslate"><span class="pre">i</span></code>th word of the source sentence is aligned with the <code class="docutils literal notranslate"><span class="pre">j</span></code>th word of the target sentence (zero-indexed).</p>
<p>This file should then be added in the data configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
  <span class="nt">train_alignments</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">train-alignment.txt</span>

<span class="nt">params</span><span class="p">:</span>
  <span class="nt">guided_alignment_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ce</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-location">
<h2>Data location<a class="headerlink" href="#data-location" title="Permalink to this headline">¶</a></h2>
<p>By default, the data are expected to be on the same filesystem. However, it is possible to reference data stored in HDFS, Amazon S3, or any other remote storages supported by TensorFlow. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
  <span class="nt">train_features_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">s3://namebucket/toy-ende/src-train.txt</span>
  <span class="nt">train_labels_file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hdfs://namenode:8020/toy-ende/tgt-train.txt</span>
</pre></div>
</div>
<p>For more information, see the TensorFlow documentation:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.tensorflow.org/deploy/hadoop">How to run TensorFlow on Hadoop</a></li>
<li><a class="reference external" href="https://www.tensorflow.org/deploy/s3">How to run TensorFlow on S3</a></li>
</ul>
</div>
<div class="section" id="pretrained-embeddings">
<h2>Pretrained embeddings<a class="headerlink" href="#pretrained-embeddings" title="Permalink to this headline">¶</a></h2>
<p>Pretrained embeddings can be configured in the <code class="docutils literal notranslate"><span class="pre">data</span></code> section, e.g.:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
  <span class="nt">source_embedding</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">data/glove/glove-100000.txt</span>
    <span class="nt">with_header</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">case_insensitive</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">trainable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>The format of the embedding file and the options are described in the <a class="reference external" href="http://opennmt.net/OpenNMT-tf/package/opennmt.inputters.text_inputter.html#opennmt.inputters.text_inputter.load_pretrained_embeddings">load_pretrained_embeddings</a> function.</p>
</div>
<div class="section" id="parallel-inputs">
<h2>Parallel inputs<a class="headerlink" href="#parallel-inputs" title="Permalink to this headline">¶</a></h2>
<p>When using <code class="docutils literal notranslate"><span class="pre">opennmt.inputters.ParallelInputter</span></code>, as many input files as inputters are expected. You have to configure your YAML file accordingly:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
  <span class="nt">train_features_file</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">train_source_1.records</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">train_source_2.txt</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">train_source_3.txt</span>

  <span class="c1"># If you also want to configure the tokenization:</span>
  <span class="nt">source_2_tokenization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">source_3_tokenization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>

  <span class="c1"># If you also want to configure the embeddings:</span>
  <span class="nt">source_2_embedding</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="nt">source_3_embedding</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>Similarly, when using the <code class="docutils literal notranslate"><span class="pre">--features_file</span></code> command line option of the main script (e.g. for inference or scoring), a list of files must also be provided:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>onmt.main infer <span class="o">[</span>...<span class="o">]</span> <span class="se">\</span>
    --features_file test_source_1.records test_source_2.txt test_source_3.txt
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tokenization.html" class="btn btn-neutral float-right" title="Tokenization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral float-left" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, The OpenNMT Authors

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>